{% load static %}
<!DOCTYPE html>
<html lang="{{ current_language }}">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ translations.takeopinion }}</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link href="{% static 'css/main.css' %}" rel="stylesheet" />
    <!-- Home Page CSS (load only on home page) -->
    {% if request.path == '/' %}
    <link href="{% static 'css/home.css' %}" rel="stylesheet" />
    {% endif %}
    <!-- Dashboard CSS (load on all dashboard pages) -->
    {% if '/admin/dashboard/' in request.path or '/doctor/profile/' in request.path or '/patient/dashboard/' in request.path %}
    <link href="{% static 'css/dashboard.css' %}" rel="stylesheet" />
    {% endif %}
    <style>
      /* Custom styles for dropdown menu items */
      .dropdown-menu .dropdown-item {
        color: #000 !important;
      }
      
      .dropdown-menu .dropdown-item:hover {
        color: #fff !important;
        background-color: #0d6efd !important;
      }
      
      /* Active dropdown items */
      .dropdown-menu .dropdown-item.active {
        color: #fff !important;
        background-color: #0d6efd !important;
      }
      
      /* Submenu styles */
      .dropdown-submenu {
        position: relative;
      }
      
      .dropdown-submenu>.dropdown-menu {
        top: 0;
        left: 100%;
        margin-top: -6px;
        margin-left: -1px;
        border-radius: 0 6px 6px 6px;
      }
      
      .dropdown-submenu:hover>.dropdown-menu {
        display: block;
      }
      
      .dropdown-submenu>a:after {
        display: block;
        content: " ";
        float: right;
        width: 0;
        height: 0;
        border-color: transparent;
        border-style: solid;
        border-width: 5px 0 5px 5px;
        border-left-color: #ccc;
        margin-top: 5px;
        margin-right: -10px;
      }
      
      .dropdown-submenu:hover>a:after {
        border-left-color: #fff;
      }
      
      .dropdown-submenu.pull-left {
        float: none;
      }
      
      .dropdown-submenu.pull-left>.dropdown-menu {
        left: -100%;
        margin-left: 10px;
        border-radius: 6px 0 6px 6px;
      }
      
      /* User profile dropdown styles */
      .user-dropdown .dropdown-toggle {
        font-weight: 500 !important;
        padding: 0.5rem 1rem !important;
        border-radius: 0.5rem !important;
        transition: all 0.2s ease !important;
      }
      
      .user-dropdown .dropdown-menu {
        border-radius: 0.5rem !important;
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        padding: 0.5rem !important;
        min-width: 200px !important;
      }
      
      .user-dropdown .dropdown-item {
        padding: 0.5rem 1rem !important;
        border-radius: 0.25rem !important;
        font-weight: 400 !important;
        transition: all 0.2s ease !important;
        margin: 0.125rem 0 !important;
      }
      
      .user-dropdown .dropdown-item:hover {
        background-color: #e9ecef !important;
        color: #0d6efd !important;
      }
      
      .user-dropdown .dropdown-divider {
        margin: 0.5rem 0 !important;
      }
      
      /* Responsive adjustments for footer */
      @media (max-width: 768px) {
        .footer-links {
          text-align: center;
        }
        
        .social-icon {
          margin: 0 0.25rem;
        }
        
        .footer-bottom {
          text-align: center;
        }
        
        .footer-bottom .text-md-end {
          text-align: center !important;
        }
      }
      
      @media (max-width: 576px) {
        .navbar-logo {
          max-height: 30px;
        }
        
        .navbar-brand {
          font-size: 1rem;
        }
        
        .nav-link {
          padding: 0.25rem 0.5rem;
          font-size: 0.9rem;
        }
        
        .user-dropdown .dropdown-toggle {
          font-size: 0.9rem !important;
          padding: 0.4rem 0.75rem !important;
        }
        
        .user-dropdown .dropdown-menu {
          min-width: 200px !important;
        }
        
        footer h5, footer h6 {
          font-size: 1rem;
        }
        
        footer p {
          font-size: 0.85rem;
        }
      }
        
        /* Fullscreen chat styles */
        .fullscreen-chat {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 9999 !important;
            border-radius: 0 !important;
            margin: 0 !important;
        }
        
        .fullscreen-chat .card-body {
            height: calc(100vh - 56px) !important; /* Account for header height */
            display: flex !important;
            flex-direction: column !important;
        }
        
        .fullscreen-chat #bot-messages {
            height: calc(100% - 120px) !important; /* Adjust based on input area height */
        }
    </style>
  </head>
  <body>
    <header class="border-bottom sticky-top shadow-sm">
      <nav class="navbar navbar-expand-lg navbar-light bg-white">
        <div class="container">
          <a
            class="navbar-brand fw-bold d-flex align-items-center gap-2"
            href="/"
          >
            <img
              src="{% static 'images/logo.png' %}"
              alt="{{ translations.takeopinion }}"
              height="40"
              width="160"
              class="navbar-logo"
            />
          </a>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#mainNav"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="mainNav">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item">
                <a
                  class="nav-link {% if request.path == '/' %}active{% endif %}"
                  href="/"
                  >{{ translations.home }}</a
                >
              </li>

              {% if user.is_authenticated %}
                {% if user.userprofile.user_type == 'admin' %}
                <!-- Admin navigation -->
                <li class="nav-item dropdown">
                  <a
                    class="nav-link dropdown-toggle"
                    href="#"
                    role="button"
                    data-bs-toggle="dropdown"
                  >
                    {{ translations.medical_services }}
                  </a>
                  <ul class="dropdown-menu">
                    <li>
                      <a
                        class="dropdown-item {% if request.path|slice:':9' == '/doctors/' %}active{% endif %}"
                        href="/doctors/"
                        >{{ translations.doctors }}</a
                      >
                    </li>
                    <li>
                      <a
                        class="dropdown-item {% if request.path|slice:':11' == '/hospitals/' %}active{% endif %}"
                        href="/hospitals/"
                        >{{ translations.hospitals }}</a
                      >
                    </li>
                    <li>
                      <a
                        class="dropdown-item {% if request.path|slice:':12' == '/treatments/' %}active{% endif %}"
                        href="/treatments/"
                        >{{ translations.treatments }}</a
                      >
                    </li>
                  </ul>
                </li>
                {% elif user.userprofile.user_type == 'patient' %}
                <!-- Patient navigation -->
                <li class="nav-item dropdown">
                  <a
                    class="nav-link dropdown-toggle"
                    href="#"
                    role="button"
                    data-bs-toggle="dropdown"
                  >
                    {{ translations.medical_services }}
                  </a>
                  <ul class="dropdown-menu">
                    <li>
                      <a
                        class="dropdown-item {% if '/doctors/' in request.path %}active{% endif %}"
                        href="/doctors/"
                        >{{ translations.doctors }}</a
                      >
                    </li>
                    <li>
                      <a
                        class="dropdown-item {% if '/hospitals/' in request.path %}active{% endif %}"
                        href="/hospitals/"
                        >{{ translations.hospitals }}</a
                      >
                    </li>
                    <li>
                      <a
                        class="dropdown-item {% if '/treatments/' in request.path %}active{% endif %}"
                        href="/treatments/"
                        >{{ translations.treatments }}</a
                      >
                    </li>
                  </ul>
                </li>
                <li class="nav-item dropdown">
                  <a
                    class="nav-link dropdown-toggle"
                    href="#"
                    role="button"
                    data-bs-toggle="dropdown"
                  >
                    {{ translations.resources }}
                  </a>
                  <ul class="dropdown-menu">
                    <li>
                      <a
                        class="dropdown-item {% if '/blogs/' in request.path %}active{% endif %}"
                        href="/blogs/"
                        >{{ translations.blogs }}</a
                      >
                    </li>
                    <li>
                      <a
                        class="dropdown-item {% if request.path|slice:':8' == '/reviews/' %}active{% endif %}"
                        href="{% url 'accounts:reviews_page' %}"
                        >{{ translations.reviews }}</a
                      >
                    </li>
                    
                    <li>
                      <a
                        class="dropdown-item {% if request.path|slice:':8' == '/hotels/' %}active{% endif %}"
                        href="{% url 'hotels:list' %}"
                        >{{ translations.hotels }}</a
                      >
                    </li>
                  </ul>
                </li>
                <li class="nav-item">
                  <a
                    class="dropdown-item {% if '/compare-treatments/' in request.path %}active{% endif %}"
                    href="/compare-treatments/"
                    >Pricing</a
                  >
                </li>
                <li class="nav-item">
                  
                </li>
                {% elif user.userprofile.user_type == 'doctor' %}
                <!-- Doctor navigation -->
                <li class="nav-item dropdown">
                  <a
                    class="nav-link dropdown-toggle"
                    href="#"
                    role="button"
                    data-bs-toggle="dropdown"
                  >
                    {{ translations.medical_services }}
                  </a>
                  <ul class="dropdown-menu">
                    <li>
                      <a
                        class="dropdown-item {% if request.path|slice:':9' == '/doctors/' %}active{% endif %}"
                        href="/doctors/"
                        >{{ translations.doctors }}</a
                      >
                    </li>
                    <li>
                      <a
                        class="dropdown-item {% if request.path|slice:':11' == '/hospitals/' %}active{% endif %}"
                        href="/hospitals/"
                        >{{ translations.hospitals }}</a
                      >
                    </li>
                    <li>
                      <a
                        class="dropdown-item {% if request.path|slice:':12' == '/treatments/' %}active{% endif %}"
                        href="/treatments/"
                        >{{ translations.treatments }}</a
                      >
                    </li>
                  </ul>
                </li>
                {% endif %}
              {% else %}
              <!-- Guest navigation -->
              <li class="nav-item dropdown">
                <a
                  class="nav-link dropdown-toggle"
                  href="#"
                  role="button"
                  data-bs-toggle="dropdown"
                >
                  {{ translations.medical_services }}
                </a>
                <ul class="dropdown-menu">
                  <li>
                    <a
                      class="dropdown-item {% if '/doctors/' in request.path %}active{% endif %}"
                      href="/doctors/"
                      >{{ translations.doctors }}</a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item {% if '/hospitals/' in request.path %}active{% endif %}"
                      href="/hospitals/"
                      >{{ translations.hospitals }}</a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item {% if '/treatments/' in request.path %}active{% endif %}"
                      href="/treatments/"
                      >{{ translations.treatments }}</a
                    >
                  </li>
                  <li>
                    <a
                    class="dropdown-item {% if '/compare-treatments/' in request.path %}active{% endif %}"
                    href="/compare-treatments/"
                    >Pricing</a
                  >
                  </li>
                </ul>
              </li>
              <li class="nav-item dropdown">
                <a
                  class="nav-link dropdown-toggle"
                  href="#"
                  role="button"
                  data-bs-toggle="dropdown"
                >
                  Resources
                </a>
                <ul class="dropdown-menu">
                  <li>
                    <a
                      class="dropdown-item {% if '/blogs/' in request.path %}active{% endif %}"
                      href="/blogs/"
                      >Blogs</a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item {% if request.path|slice:':8' == '/reviews/' %}active{% endif %}"
                      href="{% url 'accounts:reviews_page' %}"
                      >Reviews</a
                    >
                  </li>
                  
                </ul>
              </li>
              {% endif %}
            </ul>
            <!-- Search Form -->
            <form class="d-flex me-3" action="/search/" method="get">
              <div class="input-group">
                <input name="q" class="form-control border-end-0" type="search" placeholder="{{ translations.search_doctors_hospitals_treatments }}" aria-label="Search">
                <button class="btn btn-outline-primary border-start-0" type="submit">
                  <i class="bi bi-search"></i>
                </button>
              </div>
            </form>
            <!-- Language Selector -->
            <div class="dropdown me-3">
              <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="languageDropdown" data-bs-toggle="dropdown">
                <i class="bi bi-globe"></i> {{ current_language|upper }}
              </button>
              <ul class="dropdown-menu" aria-labelledby="languageDropdown">
                {% for lang_code, lang_name in available_languages %}
                <li>
                  <form action="{% url 'set_language' %}" method="post" style="display: inline;">
                    {% csrf_token %}
                    <input name="next" type="hidden" value="{{ request.get_full_path }}">
                    <input name="language" type="hidden" value="{{ lang_code }}">
                    <button class="dropdown-item" type="submit">{{ lang_name }} ({{ lang_code|upper }})</button>
                  </form>
                </li>
                {% endfor %}
              </ul>
            </div>
            <!-- Authentication buttons removed -->
            <div class="d-flex gap-2 align-items-center">
              <!-- Login/Signup/Logout functionality has been removed -->
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main>
      {% if messages %}
      <div class="container mt-3">
        {% for message in messages %}
        <div
          class="alert alert-{{ message.tags }} alert-dismissible fade show"
          role="alert"
        >
          {{ message }}
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="alert"
            aria-label="Close"
          ></button>
        </div>
        {% endfor %}
      </div>
      {% endif %} {% block content %}{% endblock %}
    </main>

    <footer class="bg-light text-dark pt-5 pb-4 border-top">
      <div class="container">
        <div class="row">
          <!-- Company Info -->
          <div class="col-lg-4 col-md-6 mb-4 mb-md-0">
            <h5 class="fw-bold mb-3 text-dark">TakeOpinion</h5>
            <p class="mb-4 text-muted">
              Your trusted partner for medical travel and treatment decisions.
              We help you find the right treatment, doctor, and hospital for
              your needs.
            </p>
            <div class="d-flex gap-3 mb-4">
              <a href="#" class="social-icon text-muted" title="Facebook">
                <i class="bi bi-facebook fs-4"></i>
              </a>
              <a href="#" class="social-icon text-muted" title="Twitter">
                <i class="bi bi-twitter fs-4"></i>
              </a>
              <a href="#" class="social-icon text-muted" title="Instagram">
                <i class="bi bi-instagram fs-4"></i>
              </a>
              <a href="#" class="social-icon text-muted" title="LinkedIn">
                <i class="bi bi-linkedin fs-4"></i>
              </a>
            </div>
          </div>
          
          <!-- Quick Links -->
          <div class="col-lg-2 col-md-6 mb-4 mb-md-0">
            <h6 class="fw-bold mb-3 text-dark">{{ translations.quick_links }}</h6>
            <ul class="list-unstyled footer-links">
              <li class="mb-2">
                <a href="/" class="text-decoration-none text-muted">{{ translations.home }}</a>
              </li>
              <li class="mb-2">
                <a
                  href="/treatments/"
                  class="text-decoration-none text-muted"
                  >{{ translations.treatments }}</a
                >
              </li>
              <li class="mb-2">
                <a href="/doctors/" class="text-decoration-none text-muted"
                  >{{ translations.doctors }}</a
                >
              </li>
              <li class="mb-2">
                <a href="/hospitals/" class="text-decoration-none text-muted"
                  >{{ translations.hospitals }}</a
                >
              </li>
              <li class="mb-2">
                <a
                  href="/compare-treatments/"
                  class="text-decoration-none text-muted"
                  >{{ translations.pricing }}</a
                >
              </li>
            </ul>
          </div>
          
          <!-- Patient Stories -->
          <div class="col-lg-3 col-md-6 mb-4 mb-md-0">
            <h6 class="fw-bold mb-3 text-dark">{{ translations.patient_stories }}</h6>
            <div class="d-flex flex-column gap-3">
              <!-- Story 1 -->
              <div class="d-flex">
                <div class="flex-shrink-0 me-3">
                  <div class="bg-light rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px; border: 1px solid #dee2e6;">
                    <i class="bi bi-person text-muted"></i>
                  </div>
                </div>
                <div>
                  <div class="d-flex align-items-center mb-1">
                    <div class="text-warning me-1">
                      <i class="bi bi-star-fill"></i>
                      <i class="bi bi-star-fill"></i>
                      <i class="bi bi-star-fill"></i>
                      <i class="bi bi-star-fill"></i>
                      <i class="bi bi-star-fill"></i>
                    </div>
                    <span class="small text-muted ms-1">(5.0)</span>
                  </div>
                  <p class="small text-muted mb-0">"The cardiac surgery at this hospital was life-changing..."</p>
                  <p class="small mb-0 text-muted">- Michael Johnson</p>
                </div>
              </div>
              
              <!-- Story 2 -->
              <div class="d-flex">
                <div class="flex-shrink-0 me-3">
                  <div class="bg-light rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px; border: 1px solid #dee2e6;">
                    <i class="bi bi-person text-muted"></i>
                  </div>
                </div>
                <div>
                  <div class="d-flex align-items-center mb-1">
                    <div class="text-warning me-1">
                      <i class="bi bi-star-fill"></i>
                      <i class="bi bi-star-fill"></i>
                      <i class="bi bi-star-fill"></i>
                      <i class="bi bi-star-fill"></i>
                      <i class="bi bi-star-half"></i>
                    </div>
                    <span class="small text-muted ms-1">(4.5)</span>
                  </div>
                  <p class="small text-muted mb-0">"After my knee replacement surgery, I was walking within days..."</p>
                  <p class="small mb-0 text-muted">- Sarah Williams</p>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Patient Success Stories -->
          <div class="col-lg-3 col-md-6">
            <h6 class="fw-bold mb-3 text-dark">Success Stories</h6>
            <div class="d-flex flex-column gap-3">
              <!-- Success Story 1 -->
              <div>
                <div class="d-flex align-items-center mb-1">
                  <div class="text-warning me-1">
                    <i class="bi bi-star-fill"></i>
                    <i class="bi bi-star-fill"></i>
                    <i class="bi bi-star-fill"></i>
                    <i class="bi bi-star-fill"></i>
                    <i class="bi bi-star-fill"></i>
                  </div>
                  <span class="small text-muted ms-1">(4.7)</span>
                </div>
                <p class="small text-muted mb-0">"The expertise and care I received exceeded my expectations..."</p>
                <p class="small mb-0 text-muted">- Robert K., Neurosurgery</p>
              </div>
              
              <!-- Success Story 2 -->
              <div>
                <div class="d-flex align-items-center mb-1">
                  <div class="text-warning me-1">
                    <i class="bi bi-star-fill"></i>
                    <i class="bi bi-star-fill"></i>
                    <i class="bi bi-star-fill"></i>
                    <i class="bi bi-star-fill"></i>
                    <i class="bi bi-star-half"></i>
                  </div>
                  <span class="small text-muted ms-1">(4.5)</span>
                </div>
                <p class="small text-muted mb-0">"My joint replacement surgery was a success..."</p>
                <p class="small mb-0 text-muted">- Priya S., Orthopedic Surgery</p>
              </div>
            </div>
          </div>
        </div>
        
        <hr class="my-4 border-secondary" />
        
        <div class="row align-items-center">
          <div class="col-md-6 text-center text-md-start">
            <p class="mb-0 small text-muted">
              &copy; <span data-current-year></span> TakeOpinion. All rights
              reserved.
            </p>
          </div>
          <div class="col-md-6 text-center text-md-end">
            <a
              class="me-3 text-decoration-none text-muted"
              href="{% url 'privacy' %}"
              >Privacy Policy</a
            >
            <a
              class="text-decoration-none text-muted"
              href="{% url 'terms' %}"
              >Terms of Service</a
            >
          </div>
        </div>
      </div>
    </footer>

    <script 
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" 
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" 
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" 
      crossorigin="anonymous">
    </script>
    <script src="{% static 'js/main.js' %}"></script>
        
        <!-- Floating Enquiry Bot Button (accessible to all users) -->
        <div id="floating-bot-container">
            <button id="floating-bot-btn" class="btn btn-primary rounded-circle shadow-lg" title="Ask Question">
                <i class="bi bi-robot" style="font-size: 1.5rem;"></i>
            </button>
            <div id="floating-bot-popup" class="card shadow-lg" style="display: none; position: fixed; bottom: 70px; right: 20px; width: 400px; z-index: 1000;">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <span><i class="bi bi-heart-pulse" style="color: #ff6b6b;"></i> <strong>TakeOpinion Assistant</strong> <i class="bi bi-stars" style="color: #ffd166;"></i></span>
                    <div>
                        <a href="#" class="btn btn-light btn-sm me-2" onclick="window.open('/enquiries/full-bot/', '_blank'); return false;" title="Open in Full Screen" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3);"><i class="bi bi-arrows-fullscreen"></i></a>
                        <button id="close-bot-btn" class="btn btn-light btn-sm" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3);">&times;</button>
                    </div>
                </div>
                <div class="card-body" style="height: 400px; display: flex; flex-direction: column;">
                    <div id="bot-messages" class="flex-grow-1 overflow-auto mb-2" style="max-height: 300px;">
                        <div class="message bot-message mb-2">
                            <div class="alert alert-info">
                                <strong>Bot:</strong> Hello! I'm your TakeOpinion assistant. How can I help you with our healthcare platform?
                            </div>
                        </div>
                    </div>
                    <div class="input-group mb-2">
                        <input type="text" id="bot-message-input" class="form-control" placeholder="Type your question..." autocomplete="off">
                        <button class="btn btn-primary" type="button" id="send-bot-message">
                            <i class="bi bi-send"></i>
                        </button>
                    </div>
                    <div class="d-flex justify-content-between">
                        <div class="upload-container">
                            <input type="file" id="medical-report-upload" class="form-control" style="max-width: 200px; height: 38px; padding: 0.375rem 0.75rem;" accept=".pdf,.jpg,.jpeg,.png,.gif">
                        </div>
                        <button class="btn btn-success" type="button" id="analyze-report-btn">
                            <i class="bi bi-file-earmark-medical"></i> Analyze
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <style>
            #floating-bot-container {
                position: fixed;
                bottom: 20px;
                right: 20px;
                z-index: 1000;
            }
            
            #floating-bot-btn {
                width: 70px;
                height: 70px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 6px 25px rgba(155, 89, 182, 0.5);
                background: linear-gradient(135deg, #9b59b6, #8e44ad);
                border: 3px solid white;
                font-size: 1.8rem;
                transition: all 0.3s ease;
                animation: pulse 2s infinite;
                position: relative;
            }
            
            #floating-bot-btn::before {
                content: '';
                position: absolute;
                top: -5px;
                right: -5px;
                bottom: -5px;
                left: -5px;
                border-radius: 50%;
                background: linear-gradient(135deg, #9b59b6, #3498db, #2ecc71);
                z-index: -1;
                background-size: 400% 400%;
                animation: gradientShift 4s ease infinite;
            }
            
            #floating-bot-btn:hover {
                background: linear-gradient(135deg, #3498db, #2980b9);
                transform: scale(1.15);
                box-shadow: 0 8px 30px rgba(52, 152, 219, 0.7);
            }
            
            @keyframes pulse {
                0% {
                    transform: scale(1);
                    box-shadow: 0 6px 25px rgba(52, 152, 219, 0.5);
                }
                50% {
                    transform: scale(1.05);
                    box-shadow: 0 8px 30px rgba(52, 152, 219, 0.7);
                }
                100% {
                    transform: scale(1);
                    box-shadow: 0 6px 25px rgba(155, 89, 182, 0.5);
                }
            }
            
            @keyframes gradientShift {
                0% {
                    background-position: 0% 50%;
                }
                50% {
                    background-position: 100% 50%;
                }
                100% {
                    background-position: 0% 50%;
                }
            }
            
            #floating-bot-popup {
                border-radius: 20px;
                overflow: hidden;
                border: 3px solid #3498db;
                box-shadow: 0 10px 30px rgba(52, 152, 219, 0.3);
                background: linear-gradient(135deg, #ffffff, #f8f9fa);
            }
            
            .card-header {
                background: linear-gradient(135deg, #3498db, #2980b9) !important;
                color: white !important;
                border-radius: 17px 17px 0 0 !important;
                border: none;
            }
            
            .message {
                margin-bottom: 1rem;
            }
            
            .user-message .alert {
                background: linear-gradient(135deg, #e8f4fd, #d1ecf1);
                border-color: #bee5eb;
                color: #0c5460;
                border-radius: 15px;
                border-left: 5px solid #3498db;
            }
            
            .bot-message .alert {
                background: linear-gradient(135deg, #e8f4fd, #d1ecf1);
                border-color: #bee5eb;
                color: #0c5460;
                border-radius: 15px;
                border-left: 5px solid #3498db;
            }
            
            .suggested-doctors-section {
                background: linear-gradient(135deg, #f8f9fa, #e9ecef);
                padding: 20px;
                border-radius: 15px;
                border: 2px solid #d1ecf1;
                box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
            }
            
            .list-group-item {
                border-radius: 12px !important;
                margin-bottom: 10px;
                border: 2px solid #e9ecef;
                transition: all 0.3s ease;
            }
            
            .list-group-item:hover {
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            }
            
            .btn-primary {
                background: linear-gradient(135deg, #3498db, #2980b9);
                border: none;
                border-radius: 25px;
                padding: 8px 16px;
                transition: all 0.3s ease;
            }
            
            .btn-primary:hover {
                background: linear-gradient(135deg, #2980b9, #1c6ea4);
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
            }
            
            .btn-success {
                background: linear-gradient(135deg, #2ecc71, #27ae60);
                border: none;
                border-radius: 25px;
                padding: 8px 16px;
                transition: all 0.3s ease;
            }
            
            .btn-success:hover {
                background: linear-gradient(135deg, #27ae60, #219653);
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(46, 204, 113, 0.4);
            }
        </style>
        
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // Initialize the bot for all users
                const botBtn = document.getElementById('floating-bot-btn');
                if (!botBtn) return; // Exit if element doesn't exist
                        
                const botPopup = document.getElementById('floating-bot-popup');
                const closeBtn = document.getElementById('close-bot-btn');
                const messageInput = document.getElementById('bot-message-input');
                const sendBtn = document.getElementById('send-bot-message');
                const messagesContainer = document.getElementById('bot-messages');
                
                // Toggle bot popup
                botBtn.addEventListener('click', function() {
                    if (botPopup.style.display === 'none' || botPopup.style.display === '') {
                        botPopup.style.display = 'block';
                    } else {
                        botPopup.style.display = 'none';
                    }
                });
                        
                // Close bot popup
                closeBtn.addEventListener('click', function() {
                    botPopup.style.display = 'none';
                });
                        
                // Send message function
                async function sendMessage() {
                    const message = messageInput.value.trim();
                    if (!message) return;
                            
                    // Add user message
                    addMessage('user', message);
                    messageInput.value = '';
                            
                    // Disable input while waiting for response
                    messageInput.disabled = true;
                    sendBtn.disabled = true;
                            
                    try {
                        const response = await fetch('{% url "enquiry_bot:chat_api" %}', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                            },
                            body: JSON.stringify({
                                message: message,
                                enquiry_id: null
                            })
                        });
                                
                        const data = await response.json();
                                
                        if (data.success) {
                            addMessage('bot', data.response);
                        } else {
                            addMessage('bot', 'Sorry, I encountered an error. Please try again.');
                        }
                    } catch (error) {
                        console.error('Error:', error);
                        addMessage('bot', 'Sorry, I encountered an error. Please try again.');
                    } finally {
                        messageInput.disabled = false;
                        sendBtn.disabled = false;
                        messageInput.focus();
                    }
                }
                        
                // Add message to chat
                function addMessage(sender, message) {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = `message ${sender}-message`;
                            
                    const alertClass = sender === 'user' ? 'alert-primary' : 'alert-secondary';
                    messageDiv.innerHTML = `
                        <div class="alert ${alertClass}">
                            <strong>${sender.charAt(0).toUpperCase() + sender.slice(1)}:</strong> ${message}
                        </div>
                    `;
                            
                    messagesContainer.appendChild(messageDiv);
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }
                        
                // Send message on button click
                sendBtn.addEventListener('click', sendMessage);
                        
                // Send message on Enter key
                messageInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendMessage();
                    }
                });

                // Quick action buttons functionality
                document.querySelectorAll('.quick-action').forEach(button => {
                    button.addEventListener('click', function() {
                        const question = this.getAttribute('data-question');
                        messageInput.value = question;
                        sendMessage();
                    });
                });

                // Handle medical report analysis
                document.getElementById('analyze-report-btn').addEventListener('click', function() {
                    const fileInput = document.getElementById('medical-report-upload');
                    const file = fileInput.files[0];
                            
                    if (!file) {
                        alert('Please select a medical report file first.');
                        return;
                    }
                            
                    const formData = new FormData();
                    formData.append('medical_report', file);
                            
                    // Show loading message
                    addMessage('bot', 'Analyzing your medical report... Please wait.');
                            
                    fetch('{% url "enquiry_bot:analyze_report" %}', {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Clear previous messages and show analysis
                            document.getElementById('bot-messages').innerHTML = '';
                            addMessage('bot', '<strong>Medical Report Analysis:</strong><br>' + data.analysis.replace(/\n/g, '<br>'));
                                    
                            // If there are suggested doctors, display them with booking options
                            if (data.suggested_doctors && data.suggested_doctors.length > 0) {
                                let doctorListHtml = '<div class="suggested-doctors-section mt-3"><strong>Suggested Doctors:</strong><ul class="list-group mt-2">';
                                        
                                data.suggested_doctors.forEach(function(doctor) {
                                    doctorListHtml += `<li class="list-group-item d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6>${doctor.name}</h6>
                                        <small class="text-muted">${doctor.specialization} | Exp: ${doctor.experience_years} years</small>
                                        <small class="text-muted d-block">Hospitals: ${doctor.hospitals}</small>
                                        </div>
                                        <div>
                                            <a href="/book/consultation/${doctor.id}/" class="btn btn-sm btn-primary me-1">Book Consultation</a>
                                            <a href="${doctor.profile_url}" class="btn btn-sm btn-outline-secondary">Profile</a>
                                        </div>
                                    </li>`;
                                });
                                        
                                doctorListHtml += '</ul></div>';
                                addMessage('bot', doctorListHtml);
                            } else {
                                // If no specific doctors found, suggest general physicians
                                addMessage('bot', 'Based on your report, we recommend consulting with a general physician or specialist. You can search for doctors by specialty through our platform.');
                            }
                        } else {
                            // Handle different types of errors
                            let errorMessage = data.error;
                                    
                            // Check if it's a rate limit error and provide helpful message
                            if (data.error.includes('Rate limit exceeded') || data.error.includes('insufficient_quota')) {
                                errorMessage = 'We have reached our AI analysis limit. Please try again later or contact support for assistance.';
                            }
                                    
                            addMessage('bot', 'Error analyzing report: ' + errorMessage);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        addMessage('bot', 'Error analyzing report: ' + error.message);
                    });
                });
            });
        </script>
    <script>
        // Fullscreen mode functionality for floating bot
        function toggleFullscreenMode() {
            const botPopup = document.getElementById('floating-bot-popup');
            const botBtn = document.getElementById('floating-bot-btn');
            
            // Toggle fullscreen class
            botPopup.classList.toggle('fullscreen-chat');
            
            if (botPopup.classList.contains('fullscreen-chat')) {
                // Fullscreen mode
                botPopup.style.position = 'fixed';
                botPopup.style.top = '0';
                botPopup.style.left = '0';
                botPopup.style.width = '100vw';
                botPopup.style.height = '100vh';
                botPopup.style.zIndex = '9999';
                botPopup.style.borderRadius = '0';
                botBtn.style.display = 'none'; // Hide the floating button
                
                // Change icon back to minimize
                const fullscreenBtn = document.querySelector('.btn-light.btn-sm.me-2');
                if (fullscreenBtn) {
                    fullscreenBtn.title = 'Minimize';
                    const icon = fullscreenBtn.querySelector('i');
                    if (icon) {
                        icon.className = 'bi bi-fullscreen-exit';
                    }
                }
            } else {
                // Normal mode
                botPopup.style.position = 'fixed';
                botPopup.style.top = 'auto';
                botPopup.style.left = 'auto';
                botPopup.style.width = '400px';
                botPopup.style.height = 'auto';
                botPopup.style.bottom = '70px';
                botPopup.style.right = '20px';
                botPopup.style.borderRadius = '20px';
                botBtn.style.display = 'flex'; // Show the floating button
                
                // Change icon back to fullscreen
                const fullscreenBtn = document.querySelector('.btn-light.btn-sm.me-2');
                if (fullscreenBtn) {
                    fullscreenBtn.title = 'Toggle Full Screen';
                    const icon = fullscreenBtn.querySelector('i');
                    if (icon) {
                        icon.className = 'bi bi-arrows-fullscreen';
                    }
                }
            }
        }

        // Enable dropdown submenu functionality
        document.addEventListener('DOMContentLoaded', function() {
          // Add hover functionality for dropdown submenus
          var dropdownSubmenus = document.querySelectorAll('.dropdown-submenu');
          dropdownSubmenus.forEach(function(submenu) {
            submenu.addEventListener('mouseover', function() {
              this.querySelector('.dropdown-menu').style.display = 'block';
            });
            submenu.addEventListener('mouseout', function() {
              this.querySelector('.dropdown-menu').style.display = 'none';
            });
          });
        });
      </script>
    </body>
  </html>